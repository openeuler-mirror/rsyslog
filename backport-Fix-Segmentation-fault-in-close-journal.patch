From eab250be3701b6aa5ccc65f2f79fd5b41f08b2b2 Mon Sep 17 00:00:00 2001
From: "t.feng" <t.feng94@foxmail.com>
Date: Mon, 8 Aug 2022 11:36:59 +0800
Subject: [PATCH] Fix Segmentation fault in close journal

Conflict:NA
Reference:https://github.com/rsyslog/rsyslog/commit/eab250be3701b6aa5ccc65f2f79fd5b41f08b2b2

---
 plugins/imjournal/imjournal.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/plugins/imjournal/imjournal.c b/plugins/imjournal/imjournal.c
index 53034fe..6fb3b7a 100644
--- a/plugins/imjournal/imjournal.c
+++ b/plugins/imjournal/imjournal.c
@@ -1001,7 +1001,9 @@ CODESTARTafterRun
 		persistJournalState();
 	}
 	closeJournal();
-	ratelimitDestruct(ratelimiter);
+	if (ratelimiter) {
+		ratelimitDestruct(ratelimiter);
+	}
 ENDafterRun
 
 
-- 
2.23.0